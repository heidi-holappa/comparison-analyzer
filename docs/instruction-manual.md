# Instruction manual

## Installation
Clone the project from GitHub. Create and launch a virtual environment for python 

```
python3 -m venv venv
source venv/bin/activate
```

and install dependencies
```
pip install -r requirements.txt
```

## Running application

The application is run with the following command
```
python3 src/compana.py <arguments>
```

The application accepts the following arguments

| Short | Long | Description |
| --- | --- | --- |
| g | gffcompare_gtf | provide full path for `gtf` file produced by `gffcompare`. |
| r | reference_gtf | provide full path for reference `gtf` file used to create the `gffcompare` `gtf`-file. |
| f | force | force re-creation of sqlite3 database. By default a new database is not created if one already exists to improve efficiency. |
| s | stats | output statistics on class codes. | 
| c | class-code | specify one or several class codes for which to generate offset data. | 
| o | offset | provide a **closed range** of offsets to be extracted from comparison results. Provide one or two values. If one value is given, the range will be set to (0, max(0, given value)) |
| j | json | provide a filename for a json-file containing arguments. Example below. |
| a | reference_fasta | provide full path for reference FASTA-file (e.g. `fa`) |
| b | reads_bam | provide full path for reads provided to IsoQuant |
| t | reads_tsv | provide full path for `model_reads.tsv` generated by IsoQuant |
| w | window_size | window from which indels are to be searched |
| e | extended_debugging | enable extended debug output, to create more log-files | 


Arguments can also be given in json-format. An [example template](../arguments_template.json) is provided in the root directory:
```json
{
    "reads_bam": "<file.bam>",
    "reads_tsv": "<file.tsv>",
    "reference_gtf": "<file.gtf>",
    "reference_fasta": "<file.fa>",
    "gffcompare_gtf": "<file.gtf>",
    "offset": "0 4",
    "class_code": "j c k",
    "force": false,
    "window_size": "8",
    "extended_debugging": false
}
```

**Examples**

The following insruction extracts arguments from a given json file
```
python3 src/compana.py -j <arguments.json>
```

The following instruction creates sqlite3 databases for the files given with arguments `g` and `r`. If sqlite-databases exist for the given files, the existing databases are used. Argument `s` specifies that overview data is to be genegated.

```
python3 src/compana.py -i <gffcompare-file> -r <reference-file> -s 
```

The following instruction takes files given with arguments `g` and `r`. Argument `f` specifies that new databases are to be created using `gffutils` from the given files. Any existing databases will overwritten.

```
python3 src/compana.py -i <gffcompare-file> -r <reference-file> -f
```
To run the full pipeline at the minimum the following arguments should be provided: `g r c o a b t`